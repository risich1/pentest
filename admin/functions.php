<?php
function confirmQuery($result) {
    global $connection;

    if(!$result) {
        die("QUERY FAILED ." . mysqli_error($connection));
    }
}

function selectSessionForList () {
    global $connection;
    $query = "
        SELECT 
            session_id, 
            CONCAT(session_period,' ',session_time) AS session        
        FROM
            asu_session
        ORDER BY
            session_time
    ";
    $select_all_session = mysqli_query($connection,$query);
    while($row = mysqli_fetch_assoc($select_all_session)) {
        $session_id = $row['session_id'];
        $session = $row['session'];
        echo "<option value='{$session_id}'>{$session}</option>";
    }
}

function selectYearForList() {
    global $connection;
    $query = "
        SELECT 
            DATE_FORMAT(year_title, '%Y') year,
            year_title
        FROM
            asu_year
    ";   
    $select_all_year = mysqli_query($connection,$query);
    while($row = mysqli_fetch_assoc($select_all_year)) {
        $year = $row['year'];
        $year_title = $row['year_title'];
        echo "<option value='{$year_title}'>{$year}</option>";
    }
}

// Select semesters data for the list

function selectSemestersForList () {
    
    global $connection;
    
    $query = "SELECT semester_id, semester_title FROM asu_semesters";
    $select_all_semestrs = mysqli_query($connection,$query);

    while($row = mysqli_fetch_assoc($select_all_semestrs)) {

        $semester_id = $row['semester_id'];
        $semester_title = $row['semester_title'];

        echo "<option value='{$semester_id}'>{$semester_title}</option>";

    }

}

// Select regions data for the list

function selectRegionsForList () {
    
    global $connection;
    
    $query = "SELECT region_id, region_title FROM asu_region ORDER BY region_title";
    $select_all_region = mysqli_query($connection,$query);
    
    while($row = mysqli_fetch_assoc($select_all_region)) {
        
        $region_id = $row['region_id'];
        $region_title = $row['region_title'];
        
        echo "<option value='{$region_id}'>{$region_title}</option>";
        
    }
}

// Select groups data for the list

function selectGroupsForList () {
    
    global $connection;
    
    $query = "SELECT group_id, group_number FROM asu_groups ORDER BY group_number";
    $select_all_group = mysqli_query($connection,$query);
    
    while($row = mysqli_fetch_assoc($select_all_group)) {
        
        $group_id = $row['group_id'];
        $group_number = $row['group_number'];
        
        echo "<option value='{$group_id}'>{$group_number}</option>";
        
    }
    
}
// Select discipline data for the list

function selectDisciplineForList() {
    
    global $connection;
    
    $query = "SELECT id, fullname FROM clg_course ORDER BY fullname";
    $select_all_discipline = mysqli_query($connection,$query);
    
    while($row = mysqli_fetch_assoc($select_all_discipline)) {
        
        $id = $row['id'];
        $fullname = $row['fullname'];
        
        echo "<option value='{$id}'>{$fullname}</option>";
        
    }
    
}


// Selecting the learning period for the table header (view_all_teachers.php)

function selectSessionPeriodForTeachers() {
    
    global $connection;
    
    $today = date("Y-m-d");
    $current_year = date("Y");
    $current_month = date("m");
    
    if ($current_month >= '01' && $current_month <= '08') {
	//if ($current_month >= '09' && $current_month <= '12') {	
        
        $prev_year = date('Y', strtotime('-1 years'));
        $period = "{$prev_year}/{$current_year}";
        
    } else {
        
        $next_year = date('Y', strtotime('+1 years'));
        $period = "{$current_year}/{$next_year}";
        
    }
    
    $query =    "
                    SELECT
                        CONCAT(session_period,' ',session_time) session 
                        FROM asu_session
                        WHERE session_time = '$period'
                ";

    $select_session_by_period = mysqli_query($connection,$query);
    
    while($row = mysqli_fetch_assoc($select_session_by_period)) {
        
        $session = $row['session'];
        echo "<th style='padding-right: 20px;'>{$session}</th>";

    }

}

// Selecting cost treaty for (add_treaty.php and edit_treaty.php)

function selectCostTreaty($treaty_cost) {

    global $connection;
    
    if($treaty_cost) {
        $query = "SELECT cost_in_figures FROM asu_cost WHERE cost_in_figures != {$treaty_cost} GROUP BY cost_in_figures";
    } else {
        $query = "SELECT cost_in_figures FROM asu_cost GROUP BY cost_in_figures";   
    }
    
    
    $select_all_cost = mysqli_query($connection,$query);

    while($row = mysqli_fetch_assoc($select_all_cost)) {

        $cost_in_figures = $row['cost_in_figures'];

        echo "<option value='{$cost_in_figures}'>{$cost_in_figures} руб.</option>";

    }
}



// Determining the workload of teachers by periods of study (view_all_teachers.php)
// for table

function getWorkloadTeaherForTable($teacher_id) {
    
    global $connection;
    
    $today = date("Y-m-d");
    $current_year = date("Y");
    $current_month = date("m");
    
    $season_1 = 'Осенний';
    $season_2 = 'Весенний';
        
    
    if ($current_month >= '01' && $current_month <= '08') {
	//if ($current_month >= '09' && $current_month <= '12') {	
        
        $prev_year = date('Y', strtotime('-1 years'));
        $period = "{$prev_year}/{$current_year}";
        
    } else {
        
        $next_year = date('Y', strtotime('+1 years'));
        $period = "{$current_year}/{$next_year}";

    }
    
    $query  =   "
                    SELECT 
                    
                        SUM(load_teacher) AS sum 
                        
                    FROM asu_load_teacher
                    INNER JOIN asu_session
                        ON asu_load_teacher.load_session_id = asu_session.session_id
                    WHERE asu_session.session_time = '$period' 
                    AND asu_load_teacher.teacher_id = {$teacher_id}
                    AND asu_session.session_period = '$season_1'
                ";
    $select = mysqli_query($connection,$query);
    
    $row = mysqli_fetch_assoc($select);
        
    $sum = $row['sum'];

    if($sum) {
        echo "<td class='text-center'>{$sum}</td>";
    } else {
        echo "<td class='text-center'><i class='fa fa-circle-thin text-warning' aria-hidden='true'></i></td>";
    }
    
    $query  =   "
                    SELECT 
                    
                        SUM(load_teacher) AS sum 
                        
                    FROM asu_load_teacher
                    INNER JOIN asu_session
                        ON asu_load_teacher.load_session_id = asu_session.session_id
                    WHERE asu_session.session_time = '$period' 
                    AND asu_load_teacher.teacher_id = {$teacher_id}
                    AND asu_session.session_period = '$season_2'
                ";
    $select = mysqli_query($connection,$query);
    
    $row = mysqli_fetch_assoc($select);
        
    $sum = $row['sum'];

    if($sum) {
        echo "<td class='text-center'>{$sum}</td>";
    } else {
        echo "<td class='text-center'><i class='fa fa-circle-thin text-warning' aria-hidden='true'></i></td>";
    }
    
    $query  =   "
                    SELECT 
                    
                        SUM(load_teacher) AS sum 
                        
                    FROM asu_load_teacher
                    INNER JOIN asu_session
                        ON asu_load_teacher.load_session_id = asu_session.session_id
                    WHERE asu_session.session_time = '$period' 
                    AND asu_load_teacher.teacher_id = {$teacher_id}
                ";
    $select = mysqli_query($connection,$query);
    
    $row = mysqli_fetch_assoc($select);
        
    $sum = $row['sum'];

    if($sum) {
        echo "<td class='text-center'>{$sum}</td>";
    } else {
        echo "<td class='text-center'><i class='fa fa-circle-thin text-warning' aria-hidden='true'></i></td>";
    }

}















