<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <h1 class="page-header">
            <i class="fa fa-file-text fa-fw text-muted" aria-hidden="true"></i>&nbsp;Добавить дисциплину
        </h1>
    </div>
</div>   






<?php

if(isset($_POST['add_discipline'])) {

    $discipline_title = $_POST['discipline_title'];

    if($discipline_title == "" || empty($discipline_title)) { // empty - определяет, установлена ли переменная

        $message = "Это поле не должно быть пустым!";

    } else {

        $query = "INSERT INTO asu_disciplines(discipline_title, discipline_date) ";
        $query .= "VALUE('{$discipline_title}', now()) ";

        $create_discipline = mysqli_query($connection, $query);

        if(!$create_discipline) {

            die('QUERY FAILED' . mysqli_error($connection));

        }
        
        
        
        $report = "<div class='alert alert-success'>Дисциплина добавлена.</div>";
        header("refresh: 1; url=disciplines.php");
    }
}
?> 

<?php
    if(isset($_GET['delete'])) {
        $the_discipline_id = $_GET['delete'];
        $query = "DELETE FROM asu_disciplines WHERE discipline_id = {$the_discipline_id} ";
        $delete_query = mysqli_query($connection, $query);
        
        $report = "<div class='alert alert-success'>Данные удалены.</div>";
        
        header("refresh: 1; url=disciplines.php");
    }
?>

<div class="row"> 
    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
        <h4 class="text-primary"><i class="fa fa-plus-circle" aria-hidden="true"></i>&nbsp;Добавить дисциплину</h4>
        <br>
        <?php echo $report; ?>
        <form action="" method="post" enctype="multipart/form-data"> 
        <input type="hidden" name="token" value="<?php echo $_SESSION['token'] ?? '' ?>">

            <div class="form-group">
                <label for="discipline_title">Название</label>
                <p class="text-danger"><?php echo $message; ?></p>
                <input type="text" class="form-control" name="discipline_title">
            </div>

            <div class="form-group">
                <input class="btn btn-primary" type="submit" name="add_discipline" value="Добавить">
            </div>    
        </form>
    </div>
    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
        <?php 

            if(isset($_GET['edit'])) {

                include("../admin/includes/disciplines/update_discipline.php");

            }  

        ?>
    </div>
</div>
<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
        <table class="table table-hover table-bordered">
            <thead>
                <tr class="active">
                    <th class="text-center">ID</th>
                    <th>Название</th>
                    <th class="text-center">Редактировать</th>
<!--                    <th class="text-center">Удалить</th>-->
                </tr>
            </thead>

            <tbody>
                <?php
                    $query = "SELECT * FROM asu_disciplines";
                    $select_all_disciplines = mysqli_query($connection, $query);
                    while($row = mysqli_fetch_assoc($select_all_disciplines)) {             
                        $discipline_id = $row['discipline_id']; 
                        $discipline_title = $row['discipline_title'];
                        $discipline_date = $row['discipline_date'];

                        echo "<tr>";
                            echo "<td class='text-center'>{$discipline_id}</td>";
                            echo "<td>{$discipline_title}</td>";
                            echo "<td class='text-center'>
                                <a class='text-muted' href='disciplines.php?edit={$discipline_id}'>
                                    <i class='fa fa-pencil-square-o' aria-hidden='true'>
                                    </i>
                                </a>
                            </td>";
//                            echo "<td class='text-center'>
//                                <a class='text-danger' href='disciplines.php?delete={$discipline_id}'>
//                                    <i class='fa fa-trash' aria-hidden='true'>
//                                    </i>
//                                </a>
//                            </td>";
                        echo "</tr>";
                    }   
                ?>
            </tbody>
        </table>
    </div>
</div>

