<?php
    if(isset($_POST['create_academic_plan'])) {
        
        $academic_plan_direction_id = $_POST['academic_plan_direction_id'];
        $academic_plan_period = $_POST['academic_plan_period'];
        $academic_plan_organization_id = $_POST['academic_plan_organization_id'];
        $academic_plan_basic_education_id = $_POST['academic_plan_basic_education_id'];
        $academic_plan_name = $_POST['academic_plan_name'];
        $academic_plan_qualification_id = $_POST['academic_plan_qualification_id'];

        $query = "
            INSERT INTO asu_academic_plan (
                academic_plan_direction_id,
                academic_plan_period,
                academic_plan_organization_id,
                academic_plan_basic_education_id,
                academic_plan_name,
                academic_plan_qualification_id,
                academic_plan_date
            )
            VALUES (
                {$academic_plan_direction_id},
                '{$academic_plan_period}',
                {$academic_plan_organization_id},
                {$academic_plan_basic_education_id},
                '{$academic_plan_name}',
                {$academic_plan_qualification_id}, 
                now()
            )
        ";
    
        $create_academic_plan_query = mysqli_query($connection,$query);
        
        if(!$create_academic_plan_query) {        
            die("QUERY FAILED ." . mysqli_error($connection));        
        }
    
    
        $the_academic_plan_id = mysqli_insert_id($connection);

        $message = "<br><div class='alert alert-success'><i class='fa fa-refresh fa-spin fa-fw'></i> Данные сохранены.</div>";
        
        header("refresh: 1; url=./academic_plan.php");
    }
?>

<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <h1 class="page-header">
            <i class="fa fa-id-card-o fa-fw text-muted" aria-hidden="true"></i>&nbsp;Форма создания учебного плана
        </h1>
    </div>
</div> 

<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <a href="./academic_plan.php" class="btn btn-default">
            <i class="fa fa-arrow-circle-o-left fa-fw" aria-hidden="true"></i>&nbsp;Вернуться  
        </a>
    </div>
</div> 
<br>
<?php echo $message; ?> 

<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">  
        <form class="form-horizontal" action="" method="POST" enctype="multipart/form-data">
        <input type="hidden" name="token" value="<?php echo $_SESSION['token'] ?? '' ?>">
            <div class="form-group">
                <div class="col-sm-12">
                    <label for="academic_plan_name">
                        Название&nbsp; 
                        <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i>
                    </label>
                    <input type="text" class="form-control" name="academic_plan_name" placeholder="Введите название учебного плана" required>
                </div>
            </div>
            <div class="form-group">
                <div class="col-sm-12">
                    <label for="academic_plan_direction_id">
                        Направление подготовки&nbsp; 
                        <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i>
                    </label>

                    <select name="academic_plan_direction_id" class="form-control" required>
                        <option value="">Выбрать . . . </option>
                    <?php
                        $query = "SELECT * FROM asu_directions";
                        $select_directions = mysqli_query($connection,$query);

                        while($row = mysqli_fetch_assoc($select_directions)) {
                            $direction_id = $row['direction_id'];
                            $direction_code = $row['direction_code'];
                            $direction_title = $row['direction_title'];

                            echo "<option value='$direction_id'>{$direction_code}&nbsp;{$direction_title}</option>";
                        }
                    ?>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <div class="col-sm-12">
                    <label for="academic_plan_period">
                        Срок обучения (семестры)&nbsp; 
                        <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i>
                    </label>
                    <select name="academic_plan_period" class="form-control" required>
                        <option value="">Выбрать . . . </option>
                        <?php
                            $query = "SELECT * FROM asu_semesters";
                            $select_semesters = mysqli_query($connection,$query);

                            while($row = mysqli_fetch_assoc($select_semesters)) {
                                $semester_id = $row['semester_id'];
                                echo "<option value='$semester_id'>{$semester_id}</option>";
                            }
                        ?>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <div class="col-sm-12">
                    <label for="academic_plan_organization_id">
                        Образовательное учреждение&nbsp;
                        <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i>
                    </label>
                    <select name="academic_plan_organization_id" class="form-control" required>
                        <option value="">Выбрать . . . </option>
                    <?php
                        $query = "SELECT * FROM asu_organizations";
                        $select_organizations = mysqli_query($connection,$query);

                        while($row = mysqli_fetch_assoc($select_organizations)) {
                            $organization_id = $row['organization_id'];
                            $organization_title = $row['organization_title'];

                            echo "<option value='$organization_id'>{$organization_title}</option>";
                        }
                    ?>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <div class="col-sm-12">
                    <label for="academic_plan_basic_education_id">
                        Базовое образование&nbsp;
                        <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i>
                    </label>

                    <select name="academic_plan_basic_education_id" class="form-control" id=" " required>
                        <option value="">Выбрать . . . </option>
                    <?php
                        $query = "SELECT * FROM asu_basic_education";
                        $select_basic_education = mysqli_query($connection,$query);

                        while($row = mysqli_fetch_assoc($select_basic_education)) {
                            $basic_education_id = $row['basic_education_id'];
                            $basic_education_title = $row['basic_education_title'];

                            echo "<option value='$basic_education_id'>{$basic_education_title}</option>";
                        }

                    ?>
                    </select>

                </div>
            </div>
            
            <div class="form-group">
                <div class="col-sm-12">
                    <label for="academic_plan_qualification_id">Квалификация&nbsp;
                        <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i>
                    </label>
                    <select name="academic_plan_qualification_id" id="" class="form-control" required>
                        <option value="">Выбрать . . . </option>
                        <?php
                            $query = "SELECT * FROM asu_qualification";
                            $select_all_qualification = mysqli_query($connection,$query);

                            while($row = mysqli_fetch_assoc($select_all_qualification)) {
                                $qualification_id = $row['qualification_id'];
                                $qualificati_name = $row['qualification_name'];

                                echo "<option value='{$qualification_id}'>{$qualificati_name}</option>";
                            }
                        ?>

                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <div class="col-sm-12">
                    <div class="page-header"></div>
                    <input class="btn btn-primary" type="submit" name="create_academic_plan" value="Добавить">
                </div>
            </div>  

        </form>
    </div>
</div>