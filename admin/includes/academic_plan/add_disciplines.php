<?php

if(isset($_GET['a_id'])) {
    
    $the_academic_plan_id = $_GET['a_id'];
    
}

$query = "SELECT * FROM asu_academic_plan WHERE academic_plan_id = {$the_academic_plan_id} ";
$select_academic_plan_id = mysqli_query($connection, $query);

while($row = mysqli_fetch_assoc($select_academic_plan_id)) {

    $academic_plan_direction_id = $row['academic_plan_direction_id'];
    $academic_plan_period = $row['academic_plan_period'];
    $academic_plan_organization_id = $row['academic_plan_organization_id'];
    $academic_plan_basic_education_id = $row['academic_plan_basic_education_id'];
    $academic_plan_name = $row['academic_plan_name'];
    $academic_count_semesters = $row['academic_count_semesters'];
    
}


if(isset($_POST['create_content_discipline'])) {
        
        
        $content_discipline_d_id = $_POST['content_discipline_d_id'];
        $content_discipline_ac_plan_id = $the_academic_plan_id;
        $content_discipline_semester = $_POST['content_discipline_semester'];
        $content_discipline_courses = $_POST['content_discipline_courses'];
        $content_discipline_hour = $_POST['content_discipline_hour'];
        $content_discipline_hour_audience = $_POST['content_discipline_hour_audience'];
        $content_discipline_hour_independent = $_POST['content_discipline_hour_independent'];
        $content_discipline_hour_lecture = $_POST['content_discipline_hour_lecture'];
        $content_discipline_hour_practice = $_POST['content_discipline_hour_practice'];
        $content_discipline_hour_laboratory = $_POST['content_discipline_hour_laboratory'];
        $content_discipline_hour_courses = $_POST['content_discipline_hour_courses'];
        $content_discipline_control = $_POST['content_discipline_control'];
        $content_discipline_course_work = $_POST['content_discipline_course_work'];
//        $moodle_id = $_POST['moodle_id'];
        
        $content_discipline_date = date('d-m-y');

        $query = "INSERT INTO asu_content_discipline(content_discipline_d_id, content_discipline_ac_plan_id, content_discipline_semester, content_discipline_courses, content_discipline_hour, content_discipline_hour_audience, content_discipline_hour_independent, content_discipline_hour_lecture, content_discipline_hour_practice, content_discipline_hour_laboratory, content_discipline_hour_courses, content_discipline_control, content_discipline_course_work, content_discipline_date) ";
    
        $query .= "VALUES({$content_discipline_d_id}, {$content_discipline_ac_plan_id}, '{$content_discipline_semester}', '{$content_discipline_courses}', '{$content_discipline_hour}', '{$content_discipline_hour_audience}', '{$content_discipline_hour_independent}', '{$content_discipline_hour_lecture}', '{$content_discipline_hour_practice}', '{$content_discipline_hour_laboratory}', '{$content_discipline_hour_courses}', '{$content_discipline_control}', '{$content_discipline_course_work}', now()) ";
    
        $create_content_discipline = mysqli_query($connection,$query);
        
        if(!$create_content_discipline) {
        
            die("QUERY FAILED ." . mysqli_error($connection));
        
        }
    
        $message = "<div class='alert alert-success'><i class='fa fa-refresh fa-spin fa-fw'></i> Дисциплина добавлена.</div>";
        
        header("refresh: 1; url=./academic_plan.php?source=view_academic_plan&a_id={$the_academic_plan_id}");

}


?>

<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <h1 class="page-header">
            <i class="fa fa-plus-circle text-muted" aria-hidden="true"></i> 
            &nbsp;Добавить дисциплину в учебный план:&nbsp;<?php echo $academic_plan_name; ?>
        </h1>
    </div>
</div>
<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <a href="academic_plan.php?source=view_academic_plan&a_id=<?php echo $the_academic_plan_id; ?>" class="btn btn-default">
            <i class="fa fa-arrow-circle-o-left fa-fw" aria-hidden="true"></i>&nbsp;Вернуться  
        </a>
    </div>
</div>
<br>
<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <?php 
            $query = "SELECT * FROM asu_directions WHERE direction_id = {$academic_plan_direction_id}";
            $select_directions_id = mysqli_query($connection,$query);

            while($row = mysqli_fetch_assoc($select_directions_id)) {

                $direction_code = $row['direction_code'];
                $direction_title = $row['direction_title'];

                echo "<p><b>Направление:</b>&nbsp;{$direction_code}&nbsp;{$direction_title}</p>";

            }
        
        
            $query = "SELECT * FROM asu_basic_education WHERE basic_education_id = {$academic_plan_basic_education_id}";
            $select_basic_education_id = mysqli_query($connection,$query);

            while($row = mysqli_fetch_assoc($select_basic_education_id)) {

                $basic_education_title = $row['basic_education_title'];

                echo "<p><b>Базовое образование:</b>&nbsp;{$basic_education_title}</p>";
            }
        
            echo "<p><b>Срок обучения:</b>&nbsp;{$academic_plan_period}";
        ?>

    </div>
</div>
<?php echo $message; ?>
<div class="page-header"></div>
<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
 
        <form class="form-horizontal" action="" method="post" enctype="multipart/form-data">
           
           <div class="form-group">
                
                <div class="col-sm-12">
                    <label for="moodle_id">
                        Дисциплина Moodle 
                    </label>

                    <select name="moodle_id" class="form-control">
                        <option value=''>Выбрать . . . </option>
                    <?php

                        $query = "SELECT * FROM clg_course ORDER BY fullname";
                        $select_all_course = mysqli_query($connection,$query);

                        while($row = mysqli_fetch_assoc($select_all_course)) {

                            $id = $row['id'];
                            $fullname = $row['fullname'];

                            echo "<option value='$id'>{$fullname}</option>";
                        }

                    ?>
                    </select>

                </div>
            </div>
           
           
            <div class="form-group">
                <div class="col-sm-12">
                    <label for="content_discipline_d_id">
                        Дисциплина&nbsp; 
                        <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i>
                    </label>

                    <select name="content_discipline_d_id" class="form-control" required>
                        <option value=''>Выбрать . . . </option>
                    <?php

                        $query = "SELECT * FROM asu_disciplines ORDER BY discipline_title ";
                        $select_all_disciplines = mysqli_query($connection,$query);

                        while($row = mysqli_fetch_assoc($select_all_disciplines)) {

                            $discipline_id = $row['discipline_id'];
                            $discipline_title = $row['discipline_title'];

                            echo "<option value='$discipline_id'>{$discipline_title}</option>";
                        }

                    ?>
                    </select>

                </div>
            </div>
            
            <div class="form-group">
                <div class="col-sm-2">
                    <label for="content_discipline_semester">
                        Семестр&nbsp; 
                        <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i>
                    </label>
                    <input type="text" class="form-control" name="content_discipline_semester" required>
                </div>
                
                <div class="col-sm-2">
                    <label for="content_discipline_courses">
                        Курс&nbsp; 
                        <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i>
                    </label>
                    <input type="text" class="form-control" name="content_discipline_courses" required>
                </div>
                
                <div class="col-sm-2">
                    <label for="content_discipline_hour">
                        Часы&nbsp; 
                        <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i>
                    </label>
                    <input type="text" class="form-control" name="content_discipline_hour" required>
                </div>
                
                <div class="col-sm-2">
                    <label for="content_discipline_hour_audience">
                        Аудит. часы&nbsp; 
                        <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i>
                    </label>
                    <input type="text" class="form-control" name="content_discipline_hour_audience" required>
                </div>
                
                <div class="col-sm-2">
                    <label for="content_discipline_hour_independent">
                        Сам. часы&nbsp; 
                        <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i>
                    </label>
                    <input type="text" class="form-control" name="content_discipline_hour_independent" required>
                </div>
                
                <div class="col-sm-2">
                    <label for="content_discipline_hour_lecture">
                        Лек. часы&nbsp; 
                        <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i>
                    </label>
                    <input type="text" class="form-control" name="content_discipline_hour_lecture" required>
                </div>
 
            </div>
            <div class="form-group">
                <div class="col-sm-2">
                    <label for="content_discipline_hour_practice">
                        Практ. часы&nbsp; 
                        <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i>
                    </label>
                    <input type="text" class="form-control" name="content_discipline_hour_practice" required>
                </div>
                
                <div class="col-sm-2">
                    <label for="content_discipline_hour_laboratory">
                        Лаб. часы&nbsp; 
                        <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i>
                    </label>
                    <input type="text" class="form-control" name="content_discipline_hour_laboratory" required>
                </div>
                
                <div class="col-sm-2">
                    <label for="content_discipline_hour_courses">
                       Курс. часы&nbsp; 
                        <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i>
                    </label>
                    <input type="text" class="form-control" name="content_discipline_hour_courses" required>
                </div>
                
                <div class="col-sm-2">
                    <label for="content_discipline_control">
                        Вид контроля&nbsp; 
                        <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i>
                    </label>
                    <select name="content_discipline_control" class="form-control" required>
                        <option value=''>Выбрать . . . </option>
                        <option value='Диф. зачёт'>Диф. зачёт</option>
                        <option value='Зачёт'>Зачёт</option>
                        <option value='Курсовая работа'>Курсовая работа</option>
                        <option value='Экзамен'>Экзамен</option>
                    </select>
                </div>
                <div class="col-sm-2">
                    <label for="content_discipline_course_work">
                        Курсовая работа
                    </label>
                    <select name="content_discipline_course_work" class="form-control">
                        <option value='Нет'>Нет</option>
                        <option value='Есть'>Есть</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <div class="col-sm-12">
                    <input class="btn btn-primary" type="submit" name="create_content_discipline" value="Добавить">
                </div>
            </div>  

        </form>
  
    </div>
</div>


