<?php

if(isset($_GET['a_id'])) {
    
    $the_academic_plan_id = $_GET['a_id'];

    $query = "SELECT * FROM asu_academic_plan WHERE academic_plan_id = {$the_academic_plan_id} ";
    $select_academic_plan_id = mysqli_query($connection, $query);

    while($row = mysqli_fetch_assoc($select_academic_plan_id)) {

        $academic_plan_direction_id = $row['academic_plan_direction_id'];
        $academic_plan_period = $row['academic_plan_period'];
        $academic_plan_organization_id = $row['academic_plan_organization_id'];
        $academic_plan_basic_education_id = $row['academic_plan_basic_education_id'];
        $academic_plan_name = $row['academic_plan_name'];
        $academic_count_semesters = $row['academic_count_semesters'];

    }

}

if(isset($_GET['con_dis_id'])) {
    
    $the_content_discipline_id = $_GET['con_dis_id'];

    $query = "SELECT * FROM asu_content_discipline WHERE content_discipline_id = {$the_content_discipline_id} ";
    $select_content_discipline_by_id = mysqli_query($connection, $query);

    while($row = mysqli_fetch_assoc($select_content_discipline_by_id)) {

        $content_discipline_id = $row['content_discipline_id'];
        $content_discipline_d_id = $row['content_discipline_d_id'];
        $content_discipline_semester = $row['content_discipline_semester'];
        $content_discipline_courses = $row['content_discipline_courses'];
        $content_discipline_hour = $row['content_discipline_hour'];
        $content_discipline_hour_audience = $row['content_discipline_hour_audience'];
        $content_discipline_hour_independent = $row['content_discipline_hour_independent'];
        $content_discipline_hour_lecture = $row['content_discipline_hour_lecture'];
        $content_discipline_hour_practice = $row['content_discipline_hour_practice'];
        $content_discipline_hour_laboratory = $row['content_discipline_hour_laboratory'];
        $content_discipline_hour_courses = $row['content_discipline_hour_courses']; 
        $content_discipline_control = $row['content_discipline_control'];
        $content_discipline_course_work = $row['content_discipline_course_work'];
        $moodle_id = $row['moodle_id'];

    }

}    
    
if(isset($_POST['update_content_discipline'])) {
        
        
        $content_discipline_d_id = $_POST['content_discipline_d_id'];
        $content_discipline_ac_plan_id = $the_academic_plan_id;
        $content_discipline_session = $_POST['content_discipline_session'];
        $content_discipline_semester = $_POST['content_discipline_semester'];
        $content_discipline_courses = $_POST['content_discipline_courses'];
        $content_discipline_hour = $_POST['content_discipline_hour'];
        $content_discipline_hour_audience = $_POST['content_discipline_hour_audience'];
        $content_discipline_hour_independent = $_POST['content_discipline_hour_independent'];
        $content_discipline_hour_lecture = $_POST['content_discipline_hour_lecture'];
        $content_discipline_hour_practice = $_POST['content_discipline_hour_practice'];
        $content_discipline_hour_laboratory = $_POST['content_discipline_hour_laboratory'];
        $content_discipline_hour_courses = $_POST['content_discipline_hour_courses'];
        $content_discipline_control = $_POST['content_discipline_control'];
        $content_discipline_course_work = $_POST['content_discipline_course_work'];
        $moodle_id = $_POST['moodle_id'];
    
        $query = "UPDATE asu_content_discipline SET ";
        $query .= "content_discipline_d_id = {$content_discipline_d_id}, ";      
        $query .= "content_discipline_session = {$content_discipline_session}, ";      
        $query .= "content_discipline_semester = '{$content_discipline_semester}', ";
        $query .= "content_discipline_courses = '{$content_discipline_courses}', ";
        $query .= "content_discipline_hour = '{$content_discipline_hour}', ";
        $query .= "content_discipline_hour_audience = '{$content_discipline_hour_audience}', ";
        $query .= "content_discipline_hour_independent = '{$content_discipline_hour_independent}', ";
        $query .= "content_discipline_hour_lecture = '{$content_discipline_hour_lecture}', ";
        $query .= "content_discipline_hour_practice = '{$content_discipline_hour_practice}', ";
        $query .= "content_discipline_hour_laboratory = '{$content_discipline_hour_laboratory}', ";
        $query .= "content_discipline_hour_courses = '{$content_discipline_hour_courses}', ";
        $query .= "content_discipline_control = '{$content_discipline_control}', ";
        $query .= "content_discipline_course_work = '{$content_discipline_course_work}', ";
        $query .= "moodle_id = {$moodle_id} ";
        
        $query .= "WHERE content_discipline_id = {$the_content_discipline_id} ";

        $update_content_discipline = mysqli_query($connection,$query);
        
        if(!$update_content_discipline) {
        
            die("QUERY FAILED ." . mysqli_error($connection));
        
        }
    
        $message = "<div class='alert alert-success'><i class='fa fa-refresh fa-spin fa-fw'></i> Данные обновлены.</div>";
        
        header("refresh: 1; url=./academic_plan.php?source=view_academic_plan&a_id={$the_academic_plan_id}");

}


?>

<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <h1 class="page-header">
            <i class="fa fa-plus-circle text-muted" aria-hidden="true"></i> 
            &nbsp;Редактировать дисциплину в учебном плане:&nbsp;<?php echo $academic_plan_name; ?>
        </h1>
    </div>
</div>
<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <a href="academic_plan.php?source=view_academic_plan&a_id=<?php echo $the_academic_plan_id; ?>" class="btn btn-default">
            <i class="fa fa-arrow-circle-o-left fa-fw" aria-hidden="true"></i>&nbsp;Вернуться  
        </a>
    </div>
</div>
<br>

<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <?php 
            $query = "SELECT * FROM asu_directions WHERE direction_id = {$academic_plan_direction_id}";
            $select_directions_id = mysqli_query($connection,$query);

            while($row = mysqli_fetch_assoc($select_directions_id)) {

                $direction_code = $row['direction_code'];
                $direction_title = $row['direction_title'];

                echo "<p><b>Направление:</b>&nbsp;{$direction_code}&nbsp;{$direction_title}</p>";

            }
        
        
            $query = "SELECT * FROM asu_basic_education WHERE basic_education_id = {$academic_plan_basic_education_id}";
            $select_basic_education_id = mysqli_query($connection,$query);

            while($row = mysqli_fetch_assoc($select_basic_education_id)) {

                $basic_education_title = $row['basic_education_title'];

                echo "<p><b>Базовое образование:</b>&nbsp;{$basic_education_title}</p>";
            }
        
            echo "<p><b>Срок обучения:</b>&nbsp;{$academic_plan_period}";
        ?>

    </div>
</div>
<?php echo $message; ?>
<div class="page-header"></div>
<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
 
        <form class="form-horizontal" action="" method="post" enctype="multipart/form-data">
        <input type="hidden" name="token" value="<?php echo $_SESSION['token'] ?? '' ?>">

            <div class="form-group">
                
                <div class="col-sm-12">
                    <label for="moodle_id">
                        Дисциплина Moodle 
                    </label>

                    <select name="moodle_id" class="form-control">
                        
                    <?php
                        
                        if($moodle_id) {
                            
                            $query = "SELECT * FROM clg_course WHERE id = {$moodle_id} ";
                            $select_course_by_id = mysqli_query($connection, $query);
                            
                            $row = mysqli_fetch_assoc($select_course_by_id);
                            $id = $row['id'];
                            $fullname = $row['fullname'];
                            
                            echo "<option value='$id'>{$fullname}</option>";
                            
                            $query = "SELECT * FROM clg_course WHERE id != {$moodle_id} ORDER BY fullname";
                            $select_all_courses = mysqli_query($connection, $query);
                            
                            while($row = mysqli_fetch_assoc($select_all_courses)) {
                                
                                $id = $row['id'];
                                $fullname = $row['fullname'];
                                
                                echo "<option value = '$id'>$fullname</option>";
                                
                            }
                            
                        } else {
                            echo "<option value='0'>Выбрать . . . </option>";
                            
                            $query = "SELECT * FROM clg_course ORDER BY fullname";
                            $select_all_course = mysqli_query($connection,$query);

                            while($row = mysqli_fetch_assoc($select_all_course)) {

                                $id = $row['id'];
                                $fullname = $row['fullname'];

                                echo "<option value='$id'>{$fullname}</option>";
                            }
                            
                        }

                        

                    ?>
                    </select>

                </div>
            </div>   
               
            <div class="form-group">
                <div class="col-sm-12">
                    <label for="content_discipline_d_id">
                        Дисциплина&nbsp; 
                        <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i>
                    </label>

                    <select name="content_discipline_d_id" class="form-control" required>

                    <?php

                        $query = "SELECT * FROM asu_disciplines WHERE discipline_id = {$content_discipline_d_id} ";
                        $select_discipline_by_id = mysqli_query($connection,$query);

                        while($row = mysqli_fetch_assoc($select_discipline_by_id)) {

                            $discipline_id = $row['discipline_id'];
                            $discipline_title = $row['discipline_title'];

                            echo "<option value='$discipline_id'>{$discipline_title}</option>";

                        }

                        $query = "SELECT * FROM asu_disciplines";
                        $select_all_disciplines = mysqli_query($connection,$query);

                        while($row = mysqli_fetch_assoc($select_all_disciplines)) {

                            $discipline_id = $row['discipline_id'];
                            $discipline_title = $row['discipline_title'];

                            echo "<option value='$discipline_id'>{$discipline_title}</option>";
                        }

                    ?>
                    </select>

                </div>
            </div>
            
            
            <div class="form-group">
                <div class="col-sm-12">
                    <label for="content_discipline_session">
                        Сессия&nbsp; 
                        <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i>
                    </label>

                    <select name="content_discipline_session" class="form-control" required>

                    <?php

                        $query = "SELECT * FROM asu_session ";
                        $select_all_session = mysqli_query($connection,$query);

                        while($row = mysqli_fetch_assoc($select_all_session)) {

                            $session_id = $row['session_id'];
                            $session_period = $row['session_period'];
                            $session_time = $row['session_time'];
                            $session = $session_period;
                            $session .= " ";
                            $session .= $session_time;
                            

                            echo "<option value='$session_id'>{$session}</option>";

                        }


                    ?>
                    </select>

                </div>
            </div>
            
            <div class="form-group">
                <div class="col-sm-2">
                    <label for="content_discipline_semester">
                        Семестр&nbsp; 
                        <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i>
                    </label>
                    <input type="text" class="form-control" name="content_discipline_semester" value="<?php echo $content_discipline_semester; ?>" required>
                </div>
                
                <div class="col-sm-2">
                    <label for="content_discipline_courses">
                        Курс&nbsp; 
                        <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i>
                    </label>
                    <input type="text" class="form-control" name="content_discipline_courses" value="<?php echo $content_discipline_courses; ?>" required>
                </div>
                
                <div class="col-sm-2">
                    <label for="content_discipline_hour">
                        Часы&nbsp; 
                        <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i>
                    </label>
                    <input type="text" class="form-control" name="content_discipline_hour" value="<?php echo $content_discipline_hour; ?>" required>
                </div>
                
                <div class="col-sm-2">
                    <label for="content_discipline_hour_audience">
                        Аудит. часы&nbsp; 
                        <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i>
                    </label>
                    <input type="text" class="form-control" name="content_discipline_hour_audience" value="<?php echo $content_discipline_hour_audience; ?>" required>
                </div>
                
                <div class="col-sm-2">
                    <label for="content_discipline_hour_independent">
                        Сам. часы&nbsp; 
                        <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i>
                    </label>
                    <input type="text" class="form-control" name="content_discipline_hour_independent" value="<?php echo $content_discipline_hour_independent; ?>" required>
                </div>
                
                <div class="col-sm-2">
                    <label for="content_discipline_hour_lecture">
                        Лек. часы&nbsp; 
                        <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i>
                    </label>
                    <input type="text" class="form-control" name="content_discipline_hour_lecture" value="<?php echo $content_discipline_hour_lecture; ?>" required>
                </div>
 
            </div>
            <div class="form-group">
               
                <div class="col-sm-2">
                    <label for="content_discipline_hour_practice">
                        Практ. часы&nbsp; 
                        <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i>
                    </label>
                    <input type="text" class="form-control" name="content_discipline_hour_practice" value="<?php echo $content_discipline_hour_practice; ?>" required>
                </div>
                
                <div class="col-sm-2">
                    <label for="content_discipline_hour_laboratory">
                        Лаб. часы&nbsp; 
                        <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i>
                    </label>
                    <input type="text" class="form-control" name="content_discipline_hour_laboratory" value="<?php echo $content_discipline_hour_laboratory; ?>"  required>
                </div>
                
                <div class="col-sm-2">
                    <label for="content_discipline_hour_courses">
                       Курс. часы&nbsp; 
                        <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i>
                    </label>
                    <input type="text" class="form-control" name="content_discipline_hour_courses" value="<?php echo $content_discipline_hour_courses; ?>" required>
                </div>
                
                <div class="col-sm-2">
                    <label for="content_discipline_control">
                        Вид контроля&nbsp; 
                        <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i>
                    </label>
                    <select name="content_discipline_control" class="form-control" required>
                        <option value='<?php echo $content_discipline_control; ?>'><?php echo $content_discipline_control; ?></option>
                        <option value='Диф. зачёт'>Диф. зачёт</option>
                        <option value='Зачёт'>Зачёт</option>
                        <option value='Курсовая работа'>Курсовая работа</option>
                        <option value='Экзамен'>Экзамен</option>
                    </select>
                </div>
                <div class="col-sm-2">
                    <label for="content_discipline_course_work">
                        Курсовая работа
                    </label>
                    <select name="content_discipline_course_work" class="form-control">
                        <option value='<?php echo $content_discipline_course_work; ?>'><?php echo $content_discipline_course_work; ?></option>
                        <option value='Нет'>Нет</option>
                        <option value='Есть'>Есть</option>
                    </select>
                </div>
            </div>
    

            <div class="form-group">
                <div class="col-sm-12">
                    <input class="btn btn-primary" type="submit" name="update_content_discipline" value="Сохранить">
                </div>
            </div>  

        </form>
  
    </div>
</div>


