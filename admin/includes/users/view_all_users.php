
<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <h1 class="page-header">
            <i class="fa fa-users fa-fw text-muted" aria-hidden="true"></i>&nbsp;Пользователи
        </h1>
    </div>
</div> 

<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <div class="btn-group">
            <a class="btn btn-primary" href="./users.php?source=add_user"><i class="fa fa-user-plus fa-fw" aria-hidden="true"></i>&nbsp; Добавить пользователя</a>
        </div>
    </div>
</div>

<br>
                           
<table class="table table-hover table-bordered">
<thead>
    <tr class="active">
        <th>Логин</th>
        <th>Email</th>
        <th>Фамилия</th>
        <th>Имя</th>
        <th>Отчество</th>
        <th>Телефон</th>
        <th>Регион</th>
        <th>Роль</th>
        <th class="text-center">ID</th>
        <th class="text-center"></th>
    </tr>
</thead>
<tbody>
       
       
        <?php
            $query = "SELECT * FROM asu_users";
            $select_all_users = mysqli_query($connection, $query);

            while($row = mysqli_fetch_assoc($select_all_users)) {

                $user_id = $row['user_id'];
                $user_login = $row['user_login'];
                $user_email = $row['user_email'];
                $user_surname = $row['user_surname'];
                $user_name = $row['user_name'];
                $user_patronymic = $row['user_patronymic'];
                $user_phone = $row['user_phone'];
                $user_region_id = $row['user_region_id'];
                $user_role_id = $row['user_role_id'];

                echo "<tr>";
                echo "<td>{$user_login}</td>";
                echo "<td>{$user_email}</td>";
                echo "<td>{$user_surname}</td>";
                echo "<td>{$user_name}</td>";
                echo "<td>{$user_patronymic}</td>";
                echo "<td>{$user_phone}</td>";
                
                $query = "SELECT * FROM asu_region WHERE region_id = {$user_region_id} ";
                $select_region_by_id = mysqli_query($connection, $query);

                $row = mysqli_fetch_assoc($select_region_by_id); 
                    
                $region_title = $row['region_title'];
                    
                echo "<td>{$region_title}</td>";
                
                $query = "SELECT * FROM asu_role WHERE role_id = {$user_role_id} ";
                $select_role_by_id = mysqli_query($connection, $query);
                
                $row = mysqli_fetch_assoc($select_role_by_id); 
                    
                $role_name = $row['role_name'];
                    
                echo "<td>{$role_name}</td>";
                
                echo "<td class='text-center'>{$user_id}</td>";
                echo "<td class='text-center'>
                        <a class='text-muted' href='users.php?source=view_user&u_id={$user_id}'>
                            <i class='fa fa-address-book' aria-hidden='true'></i></a>
                            
                        <a class='text-muted' href='users.php?source=edit_user&u_id={$user_id}'><i class='fa fa-pencil-square-o' aria-hidden='true'></i></a>
                        
                        <a class='text-danger' href='users.php?delete={$user_id}'><i class='fa fa-trash' aria-hidden='true'></i></a>
                            
                        </td>";
                echo "</tr>";

            }
        ?>


</tbody>
</table>


<?php

if(isset($_GET['delete'])) {
    
    $the_user_id = $_GET['delete'];
    
    $query = "DELETE FROM asu_users WHERE user_id = {$the_user_id} ";
    
    $delete_query = mysqli_query($connection, $query);
    
    header("Location: users.php");
    
}



?>