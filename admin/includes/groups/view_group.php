<?php

if(isset($_GET['g_id'])) {
                                
    $the_group_id = $_GET['g_id'];
     
    
    $query = "SELECT * FROM asu_groups WHERE group_id = {$the_group_id} ";
    $select_all_groups = mysqli_query($connection, $query);
    while($row = mysqli_fetch_assoc($select_all_groups)) {
        
        $group_id = $row['group_id']; 
        $group_number = $row['group_number'];
        $group_ac_plan_id = $row['group_ac_plan_id'];
    }
}

?> 
<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <h1 class="page-header">
            <i class="fa fa-users fa-fw text-muted" aria-hidden="true"></i>&nbsp;Группа № <?php echo $group_number; ?>
        </h1>
    </div>
</div>


<?php
    $query = "SELECT * FROM asu_academic_plan WHERE academic_plan_id = {$group_ac_plan_id} ";
    $select_academic_plan_id = mysqli_query($connection, $query);
    while($row = mysqli_fetch_assoc($select_academic_plan_id)) {


        $academic_plan_name = $row['academic_plan_name'];
        $academic_plan_period = $row['academic_plan_period'];
        $academic_plan_direction_id = $row['academic_plan_direction_id'];

        echo "<p><b>Учебный план:</b>&nbsp;{$academic_plan_name}</p>";

        $query = "SELECT * FROM asu_directions WHERE direction_id = {$academic_plan_direction_id} ";
        $select_direction_id = mysqli_query($connection, $query);
        while($row = mysqli_fetch_assoc($select_direction_id)) {

            $direction_code = $row['direction_code'];
            $direction_title = $row['direction_title'];

            echo "<p><b>Направление подготовки:</b>&nbsp;{$direction_code} {$direction_title}</p>";
        }

        echo "<p><b>Период обучения:</b>&nbsp;{$academic_plan_period}</p>";                        

    }

?>

<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <h3 class="page-header">
            <i class="fa fa-users fa-fw text-muted" aria-hidden="true"></i>&nbsp;Состав группы
        </h3>
    </div>
</div>

<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">                         
        <table class="table table-hover table-bordered">
        <thead>
            <tr class="active">
                <th>№</th>
                <th>Фамилия</th>
                <th>Имя</th>
                <th>Отчество</th>
                <th>Статус</th>
                <th>Регион</th>
                <th class="text-center">ID</th>
                <th class="text-center">Личное дело</th>
            </tr>
        </thead>
        <tbody>

            <?php
                $query = "SELECT * FROM asu_enrollee WHERE enrollee_group_id = {$the_group_id} AND enrollee_status != 'Архив'  ORDER BY enrollee_surname";
                $select_all_enrollee = mysqli_query($connection, $query);

                while($row = mysqli_fetch_assoc($select_all_enrollee)) {
                    
                    $i++;
                    $enrollee_id = $row['enrollee_id'];
                    $enrollee_surname = $row['enrollee_surname'];
                    $enrollee_name = $row['enrollee_name'];
                    $enrollee_patronymic = $row['enrollee_patronymic'];
                    $enrollee_status = $row['enrollee_status'];
                    $enrollee_region_id = $row['enrollee_region_id'];

                    echo "<tr>";
  
                    echo "<td>{$i}</td>";
   
                    echo "<td>{$enrollee_surname}</td>";
                    echo "<td>{$enrollee_name}</td>";
                    echo "<td>{$enrollee_patronymic}</td>";
                    echo "<td>{$enrollee_status}</td>";

                    $query = "SELECT * FROM asu_region WHERE region_id = {$enrollee_region_id} ";
                    $select_region_id = mysqli_query($connection,$query);

                    while($row = mysqli_fetch_assoc($select_region_id)) {
                        
                        $region_id = $row['region_id'];
                        $region_title = $row['region_title'];

                        echo "<td>{$region_title}</td>";
                    }

                    echo "<td class='text-center'>{$enrollee_id}</td>";
                    echo "<td class='text-center'><a class='text-muted' href='enrollee.php?source=view_enrollee&e_id={$enrollee_id}'><i class='fa fa-address-book' aria-hidden='true'></i></a></td>";
                    echo "</tr>";

                }
            ?>

        </tbody>
        </table>
    </div>
</div>

<?php
	if(isset($_GET['delete'])) {
		$the_group_id = $_GET['delete'];
        $query = "DELETE FROM asu_groups WHERE group_id = {$the_group_id} ";
        $delete_query = mysqli_query($connection, $query);
        header("Location: groups.php");
    }
?>