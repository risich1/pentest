<?php 

    if(isset($_GET['s_id'])) {
        
        $s_id = $_GET['s_id'];
        
        $query = "
                    SELECT 
                        DATE_FORMAT(statements_date, '%d.%m.%Y') statements_date,
                        CONCAT(asu_session.session_period,' ',asu_session.session_time) session,
                        asu_session.session_id AS session_id,
                        clg_course.fullname AS fullname,
                        clg_course.id AS course_id,
                        asu_academic_plan.academic_plan_name AS academic_plan_name,
                        asu_academic_plan.academic_plan_id AS plan_id,
                        asu_groups.group_number AS group_number,
                        asu_groups.group_id AS group_id
                        
                        FROM asu_statements
                        
                        INNER JOIN asu_session
                            ON asu_session.session_id = asu_statements.statements_session
                        INNER JOIN clg_course
                            ON clg_course.id = asu_statements.statements_fullname
                        INNER JOIN asu_academic_plan
                            ON asu_academic_plan.academic_plan_id = asu_statements.statements_academic_plan
                        INNER JOIN asu_groups
                            ON asu_groups.group_id = asu_statements.statements_group
                        
                        WHERE statements_id = {$s_id}

                ";
        
        $select_statement_by_id = mysqli_query($connection,$query);
        
        $row = mysqli_fetch_assoc($select_statement_by_id);
        $statements_date = $row['statements_date'];
        $session_id = $row['session_id'];
        $session = $row['session'];
        $fullname = $row['fullname'];
        $plan_id = $row['plan_id'];
        $academic_plan_name = $row['academic_plan_name'];
        $group_id = $row['group_id'];
        $group_number = $row['group_number'];
        $course_id = $row['course_id'];
        
        
    }

?>




<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <h1 class="page-header">
            <i class="fa fa-id-card-o fa-fw text-muted" aria-hidden="true"></i>&nbsp;Зачетная ведомость №<?php echo $s_id; ?> от <?php echo $statements_date; ?> 
        </h1>
    </div>
</div>  
<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <div class="btn-group">
            <a href="statements.php" class="btn btn-default">
                <i class="fa fa-arrow-circle-o-left fa-fw" aria-hidden="true"></i>&nbsp;Вернуться  
            </a>
            <a class="btn btn-success" href="<?php echo $siteprefix;?>/admin/includes/pdf.php?session_id=<?php echo $session_id; ?>&group_id=<?php echo $group_id; ?>&plan_id=<?php echo $plan_id; ?>&course_id=<?php echo $course_id; ?>" target="_blank">
                <i class="fa fa-file-pdf-o" aria-hidden="true"></i>&nbsp; Создать PDF
            </a>
        </div>
    </div>
</div>
<br>
<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <div class="well">
            <p><b>Учебный период: </b><?php echo $session; ?></p>
            <p><b>Дисциплина: </b><?php echo $fullname; ?></p>
            <p><b>Учебный план: </b><?php echo $academic_plan_name; ?></p>
            <p><b>Группа: </b><?php echo $group_number; ?></p>
        </div>
    </div>
</div>
<br>
<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <table class="table table-hover table-bordered table-filter">
            <thead>
                <tr class="active">
                    <th>№</th>
                    <th>Фамилия, имя, отчество студента</th>
                    <th>Шифр</th>
                    <th>Оценка</th>
                    <th class="text-center">ID</th>
                </tr>
            </thead>
            <tbody>
                <?php
                     $query = "
                                SELECT 
                                    CONCAT(asu_enrollee.enrollee_surname,' ',asu_enrollee.enrollee_name,' ',asu_enrollee.enrollee_patronymic) AS enrollee,
                                    asu_enrollee.enrollee_id AS enrollee_id,
                                    asu_grades.grade AS grade

                                    FROM asu_statements

                                    LEFT JOIN asu_enrollee
                                    ON asu_statements.statements_group = asu_enrollee.enrollee_group_id

                                    LEFT JOIN asu_grades
                                    ON asu_enrollee.moodle_id = asu_grades.moodle_student_id AND 
                                    asu_grades.moodle_course_id = asu_statements.statements_fullname


                                    WHERE statements_id = {$s_id}
                                    ORDER BY enrollee
                            ";
        
                    $select_data_by_id = mysqli_query($connection,$query);
                    while($row = mysqli_fetch_assoc($select_data_by_id)) {

                        $number++;

                        $enrollee_id = $row['enrollee_id'];
                        $enrollee = $row['enrollee'];
                        $grade = $row['grade'];

                        echo "<tr>";
                        echo "<td>{$number}</td>";
                        echo "<td><a href='enrollee.php?source=view_enrollee&e_id={$enrollee_id}'>{$enrollee}</a></td>";
                        echo "<td>{$enrollee_id}</td>";
                        echo "<td>{$grade}</td>";
                        echo "<td>-</td>";
                        echo "</tr>";

                    }
                
                ?>
            </tbody>
        </table>
    </div>
</div>
























