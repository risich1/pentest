<?php

    if(isset($_POST['create_teacher'])) {
        
        
        $teacher_image = $_FILES['image']['name'];
        $teacher_image_temp = $_FILES['image']['tmp_name'];
        
        $teacher_surname = $_POST['teacher_surname'];
        $teacher_name = $_POST['teacher_name'];
        $teacher_patronymic = $_POST['teacher_patronymic'];
        $teacher_date_birth = $_POST['teacher_date_birth'];
        $teacher_sex = $_POST['teacher_sex'];
        $teacher_status = $_POST['teacher_status'];
        $teacher_snils = $_POST['teacher_snils'];
        $teacher_inn = $_POST['teacher_inn'];
        $teacher_position = $_POST['teacher_position'];
        $teacher_rate = $_POST['teacher_rate'];
        $teacher_phone = $_POST['teacher_phone'];
        $teacher_email = $_POST['teacher_email'];
        $teacher_location = $_POST['teacher_location'];
        $teacher_education = $_POST['teacher_education'];
        $teacher_category = $_POST['teacher_category'];
        $teacher_identification = $_POST['teacher_identification'];
        $teacher_series = $_POST['teacher_series'];
        $teacher_number_identification = $_POST['teacher_number_identification'];
        $teacher_issued_by = $_POST['teacher_issued_by'];
        $teacher_date_issue = $_POST['teacher_date_issue'];
        $teacher_place_registration = $_POST['teacher_place_registration'];
        $teacher_discipline = $_POST['teacher_discipline'];
        $teacher_discipline = serialize($teacher_discipline);
        
        $teacher_date = date('d-m-y');
        
        $papke = mkdir("images/$teacher_surname", 0700);
        move_uploaded_file($teacher_image, "$papke/$teacher_image");
       

        $query = "INSERT INTO asu_teacher (teacher_surname, teacher_name, teacher_patronymic, teacher_date_birth, teacher_sex, teacher_status, teacher_snils, teacher_inn, teacher_position, teacher_rate, teacher_phone, teacher_email, teacher_location, teacher_education, teacher_category, teacher_identification, teacher_series, teacher_number_identification, teacher_issued_by, teacher_date_issue, teacher_place_registration, teacher_discipline, teacher_date) ";
    
        $query .= "VALUES('{$teacher_surname}', '{$teacher_name}', '{$teacher_patronymic}', '{$teacher_date_birth}', '{$teacher_sex}', '{$teacher_status}', '{$teacher_snils}', '{$teacher_inn}', '{$teacher_position}', '{$teacher_rate}', '{$teacher_phone}', '{$teacher_email}', '{$teacher_location}', '{$teacher_education}', '{$teacher_category}', '{$teacher_identification}', '{$teacher_series}', '{$teacher_number_identification}', '{$teacher_issued_by}', '{$teacher_date_issue}', '{$teacher_place_registration}', '{$teacher_discipline}',  now()) ";
    
        $create_teacher_query = mysqli_query($connection,$query);
        
    
//        confirmQuery($create_teacher_query);
    
        if(!$create_teacher_query) {

            die('QUERY FAILED' . mysqli_error($connection));

        }
    
        $message = "<br><div class='alert alert-success'><i class='fa fa-refresh fa-spin fa-fw'></i> Данные сохранены.</div>";
        
        header("refresh: 1; url=./teachers.php");
        
}
        
        


?>

<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <h1 class="page-header">
            <i class="fa fa-id-card-o fa-fw text-muted" aria-hidden="true"></i>&nbsp;Форма создания карточки преподавателя
        </h1>
    </div>
</div>  
<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <a href="teachers.php" class="btn btn-default">
            <i class="fa fa-arrow-circle-o-left fa-fw" aria-hidden="true"></i>&nbsp;Вернуться  
        </a>
    </div>
</div>
<?php echo $message; ?>
  
<form class="form-horizontal" action="" method="post" enctype="multipart/form-data">
    <h3 class="page-header text-primary"><i class="fa fa-info-circle fa-fw" aria-hidden="true"></i>&nbsp;Личная информация</h3>
<!--
    <div class="form-group">
        <div class="col-sm-12">
            <label for="teacher_image">Фотография преподавателя</label><br>
            <img class="img-thumbnail" src="images/bg_photo.jpg" width="150" alt="photo">
            <input type="file" name="image">
        </div>
    </div>
-->
    
    <div class="form-group">
        <div class="col-sm-6">
            <label for="teacher_surname">Фамилия <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i></label>
            <input type="text" class="form-control" name="teacher_surname" required>
        </div>
        
        <div class="col-sm-6">
            <label for="teacher_date_birth">Дата рождения <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i></label>
            <input type="date" class="form-control" name="teacher_date_birth" required>
        </div>
    </div>
    
    <div class="form-group">
        <div class="col-sm-6">
            <label for="teacher_name">Имя <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i></label>
            <input type="text" class="form-control" name="teacher_name" required>
        </div>
        
        <div class="col-sm-6">
            <label for="teacher_sex">Пол</label>
            <select name="teacher_sex" id="" class="form-control">
                <option value="">Выбрать пол</option>
                <option value="Мужской">Мужской</option>
                <option value="Женский">Женский</option>
            </select>
        </div>
    </div>
    
    <div class="form-group">
        <div class="col-sm-6">
            <label for="teacher_patronymic">Отчество</label>
            <input type="text" class="form-control" name="teacher_patronymic">
        </div>
        
        <div class="col-sm-6">
            <label for="teacher_status">Статус</label>
            <select name="teacher_status" id="" class="form-control">
                <option value="">Выбрать статус</option>
                <option value="Действующий">Действующий</option>
                <option value="Недействующий">Недействующий</option>
            </select>
        </div>
    </div>
    
    <div class="form-group">
        <div class="col-sm-6">
            <label for="teacher_snils">СНИЛС <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i></label>
            <input type="text" class="form-control" name="teacher_snils" required>
        </div>
        
        <div class="col-sm-6">
            <label for="teacher_inn">ИНН</label>
            <input type="text" class="form-control" name="teacher_inn">
        </div>
    </div>
        
    <h3 class="page-header text-primary"><i class="fa fa-briefcase fa-fw" aria-hidden="true"></i>&nbsp;Место работы </h3>
    
    <div class="form-group">
        <div class="col-sm-6">
            <label for="teacher_position">Должность <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i></label>
            <input type="text" class="form-control" name="teacher_position" required>
        </div>
        
        <div class="col-sm-6">
            <label for="teacher_rate">Ставка</label>
            <input type="text" class="form-control" name="teacher_rate">
        </div>
    </div>


    <h3 class="page-header text-primary"><i class="fa fa-map-marker fa-fw" aria-hidden="true"></i>&nbsp;Место жительства и контактные данные </h3>
    
    <div class="form-group">
        <div class="col-sm-6">
            <label for="teacher_phone">Телефон <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i></label>
            <input type="text" class="form-control" name="teacher_phone" required>
        </div>
        
        <div class="col-sm-6">
            <label for="teacher_email">E-mail <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i></label>
            <input type="text" class="form-control" name="teacher_email" required>
        </div>
    </div> 
    
    <div class="form-group">
        <div class="col-sm-12">
            <label for="teacher_location">Место жительства <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i></label>
            <input type="text" class="form-control" name="teacher_location" required>
        </div>
    </div>
    
    <h3 class="page-header text-primary"><i class="fa fa-graduation-cap fa-fw" aria-hidden="true"></i>&nbsp;Образование</h3>
    <div class="form-group">
        <div class="col-sm-6">
            <label for="teacher_education">Базовое образование</label>
            <select name="teacher_education" id="" class="form-control">

                <option value="">Выбрать</option>
                <option value="Высшее">Высшее</option>
                <option value="Основное общее образование">Основное общее образование</option>
                <option value="Среднее">Среднее</option>
                <option value="Среднее общее образование">Среднее общее образование</option>

            </select>
        </div>
    </div>
    
    <div class="form-group">
        <div class="col-sm-6">
            <label for="teacher_category">Категория</label>
            <select name="teacher_category" id="" class="form-control">

                <option value="">Выбрать</option>
                <option value="1-я категория">1-я категория</option>
                <option value="2-я категория">2-я категория</option>
                <option value="3-я категория">3-я категория</option>
                <option value="Высшая категория">Высшая категория</option>

            </select>
        </div>
    </div>
    
    <h3 class="page-header text-primary"><i class="fa fa-id-card-o fa-fw" aria-hidden="true"></i>&nbsp;Документ удостоверяющий личность</h3>

    <div class="form-group">
        <div class="col-sm-6">
            <label for="teacher_identification">Документ <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i></label>
            <select name="teacher_identification" id="" class="form-control" required>

                <option value="">Выбрать</option>
                <option value="Паспорт гражданина РФ">Паспорт гражданина РФ</option>
                <option value="Паспорт гражданина иностранного государства">Паспорт гражданина иностранного государства</option>
                <option value="Временное удостоверение личности">Временное удостоверение личности</option>
                <option value="Военный билет">Военный билет</option>

            </select>
        </div>
    </div>
    <div class="form-group">
        <div class="col-sm-6">
            <label for="teacher_series">Серия</label>
            <input type="text" class="form-control" name="teacher_series">
        </div>
        
        <div class="col-sm-6">
            <label for="teacher_number_identification">Номер <i class="fa fa-exclamation-triangle text-danger" aria-hidden="true" title="Обязательное поле для заполнения"></i></label>
            <input type="text" class="form-control" name="teacher_number_identification" required>
        </div>
    </div>
    
    <div class="form-group">
        <div class="col-sm-6">
            <label for="teacher_issued_by">Кем выдан</label>
            <input type="text" class="form-control" name="teacher_issued_by">
        </div>
        
        <div class="col-sm-6">
            <label for="teacher_date_issue">Дата выдачи</label>
            <input type="date" class="form-control" name="teacher_date_issue">
        </div>
    </div>
    
    <div class="form-group">
        <div class="col-sm-12">
            <label for="teacher_place_registration">Место регистрации</label>
            <input type="text" class="form-control" name="teacher_place_registration">
        </div>
    </div>
    
    <h3 class="page-header text-primary"><i class="fa fa-suitcase fa-fw" aria-hidden="true"></i>&nbsp;Список дисциплин преподавателя</h3> 
    
    <select size="15" name="teacher_discipline[]" id="" class="form-control" multiple>
        
        <?php
            $query = "SELECT * FROM  asu_disciplines ORDER BY discipline_title  ";
            $select_all_discipline = mysqli_query($connection, $query);

            while($row = mysqli_fetch_assoc($select_all_discipline)) {

                $discipline_id = $row['discipline_id'];
                $discipline_title = $row['discipline_title'];
                
                echo "<option value='$discipline_id'>{$discipline_title}</option>";

            }
        ?>

    </select>
    
    <div class="form-group">
        <div class="col-sm-12">
            <div class="page-header"></div>
            <input class="btn btn-primary" type="submit" name="create_teacher" value="Добавить">
        </div>
    </div>  
    
</form>