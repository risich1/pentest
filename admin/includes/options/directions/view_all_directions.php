<?php

if(isset($_POST['add_direction'])) {

    $direction_code = $_POST['direction_code'];
    $direction_title = $_POST['direction_title'];


    $query = "INSERT INTO asu_directions(direction_code, direction_title, direction_date) ";
    $query .= "VALUE('{$direction_code}' ,'{$direction_title}', now()) ";

    $create_direction = mysqli_query($connection, $query);

    if(!$create_direction) {

        die('QUERY FAILED' . mysqli_error($connection));

    }
}

?> 
<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <h1 class="page-header">
            <i class="fa fa-database fa-fw text-muted" aria-hidden="true"></i>&nbsp;Направления подготовки
        </h1>
    </div>
</div>
   
<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
    <h4 class="text-primary"><i class="fa fa-plus-circle" aria-hidden="true"></i> Добавить направление</h4>
    <br>
    <form action="" method="post" enctype="multipart/form-data"> 
    <input type="hidden" name="token" value="<?php echo $_SESSION['token'] ?? '' ?>">

        <div class="form-group">
            <label for="direction_code">Код</label>
            <input type="text" class="form-control" name="direction_code">
        </div>
        <div class="form-group">
            <label for="direction_title">Название</label>
            <input type="text" class="form-control" name="direction_title">
        </div>

        <div class="form-group">
            <input class="btn btn-primary" type="submit" name="add_direction" value="Добавить">
        </div>    
    </form>
    
    <?php 
    
        if(isset($_GET['edit'])) {
            
            include("../admin/includes/options/directions/update_directions.php");
            
        }  
    
    ?>
    
    
</div>
<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
    <table class="table table-hover table-bordered">
        <thead>
            <tr class="active">
                <th class="text-center">ID</th>
                <th>Код</th>
                <th>Название</th>
                <th class="text-center">Редактировать</th>
                <th class="text-center">Удалить</th>
            </tr>
        </thead>

        <tbody>
            <?php
                $query = "SELECT * FROM asu_directions";
                $select_all_directions = mysqli_query($connection, $query);
                while($row = mysqli_fetch_assoc($select_all_directions)) {				
                    $direction_id = $row['direction_id']; 
                    $direction_code = $row['direction_code'];
                    $direction_title = $row['direction_title'];
                    $direction_date = $row['direction_date'];

                    echo "<tr>";
                        echo "<td class='text-center'>{$direction_id}</td>";
                        echo "<td>{$direction_code}</td>";
                        echo "<td>{$direction_title}</td>";
                        echo "<td class='text-center'>
                            <a class='text-muted' href='directions.php?edit={$direction_id}'>
                                <i class='fa fa-pencil-square-o' aria-hidden='true'>
                                </i>
                            </a>
                        </td>";
                        echo "<td class='text-center'>
                            <a class='text-danger' href='directions.php?delete={$direction_id}'>
                                <i class='fa fa-trash' aria-hidden='true'>
                                </i>
                            </a>
                        </td>";
                    echo "</tr>";
                }	
            ?>
        </tbody>
    </table>
</div>

<?php
	if(isset($_GET['delete'])) {
		$the_direction_id = $_GET['delete'];
        $query = "DELETE FROM asu_directions WHERE direction_id = {$the_direction_id} ";
        $delete_query = mysqli_query($connection, $query);
        header("Location: directions.php");
    }
?>