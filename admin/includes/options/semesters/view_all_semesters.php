<?php

if(isset($_POST['add_semester'])) {

    $semester_title = $_POST['semester_title'];

    if($semester_title == "" || empty($semester_title)) { // empty - определяет, установлена ли переменная

        $message = "Это поле не должно быть пустым!";

    } else {

        $query = "INSERT INTO asu_semesters(semester_title, semester_date) ";
        $query .= "VALUE('{$semester_title}', now()) ";

        $create_semester = mysqli_query($connection, $query);

        if(!$create_semester) {

            die('QUERY FAILED' . mysqli_error($connection));

        }

    }

}
?> 
<div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <h1 class="page-header">
            <i class="fa fa-calendar fa-fw text-muted" aria-hidden="true"></i>&nbsp;Семестры
        </h1>
    </div>
</div>
   
<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
    <h4 class="text-primary"><i class="fa fa-plus-circle" aria-hidden="true"></i> Добавить семестр</h4>
    <br>
    <form action="" method="post" enctype="multipart/form-data"> 
    <input type="hidden" name="token" value="<?php echo $_SESSION['token'] ?? '' ?>">

        <div class="form-group">
            <label for="semester_title">Название</label>
            <p class="text-danger"><?php echo $message; ?></p>
            <input type="text" class="form-control" name="semester_title">
        </div>

        <div class="form-group">
            <input class="btn btn-primary" type="submit" name="add_semester" value="Добавить">
        </div>    
    </form>
    
    <?php 
    
        if(isset($_GET['edit'])) {
            
            include("../admin/includes/options/semesters/update_semester.php");
            
        }  
    
    ?>
    
    
</div>
<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
    <table class="table table-hover table-bordered">
        <thead>
            <tr class="active">
                <th class="text-center">ID</th>
                <th>Название</th>
                <th class="text-center">Редактировать</th>
                <th class="text-center">Удалить</th>
            </tr>
        </thead>

        <tbody>
            <?php
                $query = "SELECT * FROM asu_semesters";
                $select_all_semesters = mysqli_query($connection, $query);
                while($row = mysqli_fetch_assoc($select_all_semesters)) {				
                    $semester_id = $row['semester_id']; 
                    $semester_title = $row['semester_title'];
                    $semester_date = $row['semester_date'];

                    echo "<tr>";
                        echo "<td class='text-center'>{$semester_id}</td>";
                        echo "<td>{$semester_title}</td>";
                        echo "<td class='text-center'>
                            <a class='text-muted' href='semesters.php?edit={$semester_id}'>
                                <i class='fa fa-pencil-square-o' aria-hidden='true'>
                                </i>
                            </a>
                        </td>";
                        echo "<td class='text-center'>
                            <a class='text-danger' href='semesters.php?delete={$semester_id}'>
                                <i class='fa fa-trash' aria-hidden='true'>
                                </i>
                            </a>
                        </td>";
                    echo "</tr>";
                }	
            ?>
        </tbody>
    </table>
</div>

<?php
	if(isset($_GET['delete'])) {
		$the_semester_id = $_GET['delete'];
        $query = "DELETE FROM asu_semesters WHERE semester_id = {$the_semester_id} ";
        $delete_query = mysqli_query($connection, $query);
        header("Location: semesters.php");
    }
?>