<?php

if(isset($_POST['add_region'])) {

    $region_title = $_POST['region_title'];

    if($region_title == "" || empty($region_title)) { // empty - определяет, установлена ли переменная

        $message = "Это поле не должно быть пустым!";

    } else {

        $query = "INSERT INTO asu_region(region_title, region_date) ";
        $query .= "VALUE('{$region_title}', now()) ";

        $create_region_title = mysqli_query($connection, $query);

        if(!$create_region_title) {

            die('QUERY FAILED' . mysqli_error($connection));

        }

    }

}
?> 

   
<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
    <div class="panel panel-default">
        <div class="panel-heading">
            <h4 class="text-primary"><i class="fa fa-plus-circle" aria-hidden="true"></i> Добавить регион</h4>
        </div>
        <div class="panel-body">
            <form action="" method="post" enctype="multipart/form-data"> 
            <input type="hidden" name="token" value="<?php echo $_SESSION['token'] ?? '' ?>">

                <div class="form-group">
                    <label for="region_title">Название региона</label>
                    <p class="text-danger"><?php echo $message; ?></p>
                    <input type="text" class="form-control" name="region_title">
                </div>

                <div class="form-group">
                    <input class="btn btn-primary" type="submit" name="add_region" value="Добавить">
                </div>    
            </form>
        </div>
    </div>

        <?php 

            if(isset($_GET['edit'])) {

                include ("../admin/includes/regions/update_region.php");

            }

        ?>
        
</div>
<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
    <table class="table table-hover table-bordered">
        <thead>
            <tr class="active">
                <th class="text-center">ID</th>
                <th>Название региона</th>
                <th class="text-center">Редактировать</th>
                <th class="text-center">Удалить</th>
            </tr>
        </thead>

        <tbody>
            <?php
                $query = "SELECT * FROM asu_region";
                $select_all_region = mysqli_query($connection, $query);
                while($row = mysqli_fetch_assoc($select_all_region)) {				
                    $region_id = $row['region_id']; 
                    $region_title = $row['region_title'];
                    $region_date = $row['region_date'];

                    echo "<tr>";
                        echo "<td class='text-center'>{$region_id}</td>";
                        echo "<td>{$region_title}</td>";
                        echo "<td class='text-center'>
                            <a class='text-muted' href='regions.php?edit={$region_id}'>
                                <i class='fa fa-pencil-square-o' aria-hidden='true'>
                                </i>
                            </a>
                        </td>";
                        echo "<td class='text-center'>
                            <a class='text-danger' href='regions.php?delete={$region_id}'>
                                <i class='fa fa-trash' aria-hidden='true'>
                                </i>
                            </a>
                        </td>";
                    echo "</tr>";
                }	
            ?>
        </tbody>
    </table>
</div>

<?php
	if(isset($_GET['delete'])) {
		$the_region_id = $_GET['delete'];
        $query = "DELETE FROM asu_region WHERE region_id = {$the_region_id} ";
        $delete_query = mysqli_query($connection, $query);
        header("Location: regions.php");
    }
?>