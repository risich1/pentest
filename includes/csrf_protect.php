<?php
// session_set_cookie_params([
//     // 'lifetime' => $maxlifetime,
//     'path' => $cookieConfig['path'],
//     'domain' => $cookieConfig['domain'],
//     'secure' => $cookieConfig['secure'],
//     'httponly' => $cookieConfig['httponly'],
//     'samesite' => $cookieConfig['samesite']
// ]);

session_set_cookie_params([
    'path' => '/',
    'domain' => $_SERVER['HTTP_HOST'],
    'secure' => true,
    'httponly' => true,
    'samesite' => 'lax'
]);

ob_start(); 
session_start();

if($_SERVER['REQUEST_METHOD'] == 'GET')
{
    $token = bin2hex(random_bytes(35));
    $_SESSION['token'] = $token;
    unset($_COOKIE['token']);

    setcookie(
        'token',
        $token,
        0,
        '/',
        $cookieConfig['domain'],
        $cookieConfig['sequre'],
        $cookieConfig['httponly'],
        'lax'
    );

}



if($_SERVER['REQUEST_METHOD'] === 'POST')
{
    if (empty($_POST['token']) || $_SESSION['token'] !== $_POST['token'] || $_SESSION['token'] !== $_COOKIE['token']) {
        header($_SERVER['SERVER_PROTOCOL'] . ' 405 Method Not Allowed');
        exit;
    }
}   
