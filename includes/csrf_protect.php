<?php
session_set_cookie_params([
    // 'lifetime' => $maxlifetime,
    'path' => $cookieConfig['path'],
    'domain' => $cookieConfig['domain'],
    'secure' => $cookieConfig['secure'],
    'httponly' => $cookieConfig['httponly'],
    'samesite' => $cookieConfig['samesite']
]);

session_set_cookie_params([
    'path' => $cookieConfig['path'],
    'domain' => $_SERVER['HTTP_HOST'],
    'secure' => $cookieConfig['secure'],
    'httponly' => $cookieConfig['httponly'],
    'samesite' => $cookieConfig['samesite']
]);

ob_start(); 
session_start();
if($_SERVER['REQUEST_METHOD'] == 'GET')
{
    $token = bin2hex(random_bytes(35));
    $_SESSION['token'] = $token;
    unset($_COOKIE['token']);
    setcookie('token', $token, [
        'path' => $cookieConfig['path'],
        'domain' => $cookieConfig['domain'],
        'secure' => $cookieConfig['secure'],
        'httponly' => $cookieConfig['httponly'],
        'samesite' => $cookieConfig['samesite']
    ]);
}



if($_SERVER['REQUEST_METHOD'] === 'POST')
{
    if (empty($_POST['token']) || $_SESSION['token'] !== $_POST['token'] || $_SESSION['token'] !== $_COOKIE['token']) {
        echo $_COOKIE['token'];
        header($_SERVER['SERVER_PROTOCOL'] . ' 405 Method Not Allowed');
        exit;
    }
}   
