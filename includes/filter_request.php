<?php



function _escape_str($str)
{
    $result = str_replace("'", "''", strip_tags($str));

    $replaces = ["`", "(", ")", '"', "'", '%'];

    foreach($replaces as $r)
        $result = str_replace($r, "", $result);

    return $result;
}

function validateFields($str)
{

    if (is_array($str))
    {
        foreach ($str as $key => $val)
        {
            $str[$key] = validateFields($val);
        }

        return $str;
    }

    $str = _escape_str($str);

    return $str;
}

function validateFiles()
{
    // print_r($_FILES);
    // die;
    if(count($_FILES) > 0)
    {
        $allowFormats = ['.jpg', '.gif', '.jpeg', '.png', '.xls', '.xlsx', '.doc', '.docx', '.rtf', '.mp3', '.mp4', '.wav', '.avi'];
        foreach($_FILES as $file)
        {
            $r = false;

            foreach($allowFormats as $format)
            {
                if(strripos(strtolower($file['name']), $format)) 
                    $r = true;
            }

            if(!$r) 
            {
                header($_SERVER['SERVER_PROTOCOL'] . ' 405 Method Not Allowed');
                exit();
            }
        }
    }
}

validateFiles();

$_POST = validateFields($_POST);
$_REQUEST = validateFields($_REQUEST);
$_GET = validateFields($_GET);

// echo '<pre>';
// print_r($_REQUEST);  
// echo '</pre>';
// die;